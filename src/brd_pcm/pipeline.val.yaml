meta:
  import_tasks_from: pipeline.preprocessing.yaml
  extract_upstream: false
  source_loader:
    module: brd_pcm

tasks:
  - source: scripts/val_uncal.py
    upstream: [featurize]
    product:
      nb: "{{root}}/htmls/val_uncal.html"
      predictions: "{{root}}/ml_outputs/uncal_preds.csv"
    params:
      path_to_model: "products/train/models/uncal_model.pkl.bz2"

  - source: scripts/val_cal.py
    upstream: [featurize]
    product:
      nb: "{{root}}/htmls/val_cal.html"
      predictions: "{{root}}/ml_outputs/cal_preds.csv"
    params:
      X_train_data: "products/train/data/X_train.parquet"
      y_train_data: "products/train/data/y_train.parquet"
      cv_data: "products/train/models/VA_cv_indices.pkl"
      model_folder: "products/train/models/cal_models"

  - source: scripts/analyze_val.py
    name: analyze_val_uncal
    upstream: [val_uncal]
    product:
      nb: "{{root}}/htmls/analyze_val_uncal.html"
      cmat: "{{root}}/ml_outputs/uncal_plots/uncal_cmat.png"
      conf_metrics: "{{root}}/ml_outputs/uncal_cmetrics.csv"

  - source: scripts/analyze_val.py
    name: analyze_val_cal
    upstream: [val_cal]
    product:
      nb: "{{root}}/htmls/analyze_val_cal.html"
      cmat: "{{root}}/ml_outputs/cal_plots/cal_cmat.png"
      conf_metrics: "{{root}}/ml_outputs/cal_cmetrics.csv"
